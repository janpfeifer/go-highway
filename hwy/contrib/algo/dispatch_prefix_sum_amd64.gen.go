// Code generated by hwygen. DO NOT EDIT.
//go:build amd64 && goexperiment.simd

package algo

import (
	"os"

	"github.com/ajroetker/go-highway/hwy"
	"simd/archsimd"
)

var PrefixSumFloat32 func(data []float32)
var PrefixSumFloat64 func(data []float64)
var PrefixSumInt32 func(data []int32)
var PrefixSumInt64 func(data []int64)
var PrefixSumUint32 func(data []uint32)
var PrefixSumUint64 func(data []uint64)
var DeltaDecodeInt32 func(data []int32, base int32)
var DeltaDecodeInt64 func(data []int64, base int64)
var DeltaDecodeUint32 func(data []uint32, base uint32)
var DeltaDecodeUint64 func(data []uint64, base uint64)

// PrefixSum is the generic API that dispatches to the appropriate SIMD implementation.
func PrefixSum[T hwy.Integers | hwy.FloatsNative](data []T) {
	switch any(data).(type) {
	case []float32:
		PrefixSumFloat32(any(data).([]float32))
	case []float64:
		PrefixSumFloat64(any(data).([]float64))
	case []int32:
		PrefixSumInt32(any(data).([]int32))
	case []int64:
		PrefixSumInt64(any(data).([]int64))
	case []uint32:
		PrefixSumUint32(any(data).([]uint32))
	case []uint64:
		PrefixSumUint64(any(data).([]uint64))
	}
}

// DeltaDecode is the generic API that dispatches to the appropriate SIMD implementation.
func DeltaDecode[T hwy.Integers](data []T, base T) {
	switch any(data).(type) {
	case []int32:
		DeltaDecodeInt32(any(data).([]int32), any(base).(int32))
	case []int64:
		DeltaDecodeInt64(any(data).([]int64), any(base).(int64))
	case []uint32:
		DeltaDecodeUint32(any(data).([]uint32), any(base).(uint32))
	case []uint64:
		DeltaDecodeUint64(any(data).([]uint64), any(base).(uint64))
	}
}

func init() {
	if os.Getenv("HWY_NO_SIMD") != "" {
		initPrefix_sumFallback()
		return
	}
	if archsimd.X86.AVX512() {
		initPrefix_sumAVX512()
		return
	}
	if archsimd.X86.AVX2() {
		initPrefix_sumAVX2()
		return
	}
	initPrefix_sumFallback()
}

func initPrefix_sumAVX2() {
	PrefixSumFloat32 = BasePrefixSum_avx2
	PrefixSumFloat64 = BasePrefixSum_avx2_Float64
	PrefixSumInt32 = BasePrefixSum_avx2_Int32
	PrefixSumInt64 = BasePrefixSum_avx2_Int64
	PrefixSumUint32 = BasePrefixSum_avx2_Uint32
	PrefixSumUint64 = BasePrefixSum_avx2_Uint64
	DeltaDecodeInt32 = BaseDeltaDecode_avx2_Int32
	DeltaDecodeInt64 = BaseDeltaDecode_avx2_Int64
	DeltaDecodeUint32 = BaseDeltaDecode_avx2_Uint32
	DeltaDecodeUint64 = BaseDeltaDecode_avx2_Uint64
}

func initPrefix_sumAVX512() {
	PrefixSumFloat32 = BasePrefixSum_avx512
	PrefixSumFloat64 = BasePrefixSum_avx512_Float64
	PrefixSumInt32 = BasePrefixSum_avx512_Int32
	PrefixSumInt64 = BasePrefixSum_avx512_Int64
	PrefixSumUint32 = BasePrefixSum_avx512_Uint32
	PrefixSumUint64 = BasePrefixSum_avx512_Uint64
	DeltaDecodeInt32 = BaseDeltaDecode_avx512_Int32
	DeltaDecodeInt64 = BaseDeltaDecode_avx512_Int64
	DeltaDecodeUint32 = BaseDeltaDecode_avx512_Uint32
	DeltaDecodeUint64 = BaseDeltaDecode_avx512_Uint64
}

func initPrefix_sumFallback() {
	PrefixSumFloat32 = BasePrefixSum_fallback
	PrefixSumFloat64 = BasePrefixSum_fallback_Float64
	PrefixSumInt32 = BasePrefixSum_fallback_Int32
	PrefixSumInt64 = BasePrefixSum_fallback_Int64
	PrefixSumUint32 = BasePrefixSum_fallback_Uint32
	PrefixSumUint64 = BasePrefixSum_fallback_Uint64
	DeltaDecodeInt32 = BaseDeltaDecode_fallback_Int32
	DeltaDecodeInt64 = BaseDeltaDecode_fallback_Int64
	DeltaDecodeUint32 = BaseDeltaDecode_fallback_Uint32
	DeltaDecodeUint64 = BaseDeltaDecode_fallback_Uint64
}

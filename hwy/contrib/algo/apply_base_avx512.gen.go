// Code generated by hwygen. DO NOT EDIT.
//go:build amd64 && goexperiment.simd

package algo

import (
	"simd/archsimd"
)

func BaseApply_avx512(in []float32, out []float32, fn func(archsimd.Float32x16) archsimd.Float32x16) {
	n := min(len(in), len(out))
	lanes := 16
	i := 0
	for ; i+lanes <= n; i += lanes {
		x := archsimd.LoadFloat32x16Slice(in[i:])
		fn(x).StoreSlice(out[i:])
	}
	if remaining := n - i; remaining > 0 {
		buf := [16]float32{}
		copy(buf[:], in[i:i+remaining])
		x := archsimd.LoadFloat32x16Slice(buf[:])
		fn(x).StoreSlice(buf[:])
		copy(out[i:i+remaining], buf[:remaining])
	}
}

func BaseApply_avx512_Float64(in []float64, out []float64, fn func(archsimd.Float64x8) archsimd.Float64x8) {
	n := min(len(in), len(out))
	lanes := 8
	i := 0
	for ; i+lanes <= n; i += lanes {
		x := archsimd.LoadFloat64x8Slice(in[i:])
		fn(x).StoreSlice(out[i:])
	}
	if remaining := n - i; remaining > 0 {
		buf := [8]float64{}
		copy(buf[:], in[i:i+remaining])
		x := archsimd.LoadFloat64x8Slice(buf[:])
		fn(x).StoreSlice(buf[:])
		copy(out[i:i+remaining], buf[:remaining])
	}
}

// Code generated by hwygen. DO NOT EDIT.

package matmul

import (
	"github.com/ajroetker/go-highway/hwy"
)

func BaseMatMul_fallback(a []float32, b []float32, c []float32, m int, n int, k int) {
	if len(a) < m*k {
		panic("matmul: A slice too short")
	}
	if len(b) < k*n {
		panic("matmul: B slice too short")
	}
	if len(c) < m*n {
		panic("matmul: C slice too short")
	}
	for i := 0; i < m; i++ {
		cRow := c[i*n : (i+1)*n]
		vZero := hwy.Zero[float32]()
		lanes := vZero.NumLanes()
		var j int
		for j = 0; j+lanes <= n; j += lanes {
			hwy.Store(vZero, cRow[j:])
		}
		for ; j < n; j++ {
			cRow[j] = 0
		}
		for p := 0; p < k; p++ {
			aip := a[i*k+p]
			vA := hwy.Set(aip)
			bRow := b[p*n : (p+1)*n]
			for j = 0; j+lanes <= n; j += lanes {
				vB := hwy.Load(bRow[j:])
				vC := hwy.Load(cRow[j:])
				vC = hwy.MulAdd(vA, vB, vC)
				hwy.Store(vC, cRow[j:])
			}
			for ; j < n; j++ {
				cRow[j] += aip * bRow[j]
			}
		}
	}
}

func BaseMatMul_fallback_Float64(a []float64, b []float64, c []float64, m int, n int, k int) {
	if len(a) < m*k {
		panic("matmul: A slice too short")
	}
	if len(b) < k*n {
		panic("matmul: B slice too short")
	}
	if len(c) < m*n {
		panic("matmul: C slice too short")
	}
	for i := 0; i < m; i++ {
		cRow := c[i*n : (i+1)*n]
		vZero := hwy.Zero[float64]()
		lanes := vZero.NumLanes()
		var j int
		for j = 0; j+lanes <= n; j += lanes {
			hwy.Store(vZero, cRow[j:])
		}
		for ; j < n; j++ {
			cRow[j] = 0
		}
		for p := 0; p < k; p++ {
			aip := a[i*k+p]
			vA := hwy.Set(aip)
			bRow := b[p*n : (p+1)*n]
			for j = 0; j+lanes <= n; j += lanes {
				vB := hwy.Load(bRow[j:])
				vC := hwy.Load(cRow[j:])
				vC = hwy.MulAdd(vA, vB, vC)
				hwy.Store(vC, cRow[j:])
			}
			for ; j < n; j++ {
				cRow[j] += aip * bRow[j]
			}
		}
	}
}

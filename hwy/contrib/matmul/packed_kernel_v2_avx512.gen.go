// Code generated by github.com/ajroetker/go-highway/cmd/hwygen. DO NOT EDIT.

//go:build amd64 && goexperiment.simd

package matmul

import (
	"simd/archsimd"
	"unsafe"

	"github.com/ajroetker/go-highway/hwy"
	"github.com/ajroetker/go-highway/hwy/asm"
)

func BasePackedMicroKernel4x2_avx512_Float16(packedA []hwy.Float16, packedB []hwy.Float16, output []hwy.Float16, outputStride int, outRowStart int, outColStart int, panelK int, lanes int) {
	acc00 := asm.ZeroFloat16x16AVX512()
	acc01 := asm.ZeroFloat16x16AVX512()
	acc10 := asm.ZeroFloat16x16AVX512()
	acc11 := asm.ZeroFloat16x16AVX512()
	acc20 := asm.ZeroFloat16x16AVX512()
	acc21 := asm.ZeroFloat16x16AVX512()
	acc30 := asm.ZeroFloat16x16AVX512()
	acc31 := asm.ZeroFloat16x16AVX512()
	nr := 2 * lanes
	mr := 4
	aIdx := 0
	bIdx := 0
	_ = packedA[panelK*mr-1].Float32()
	_ = packedB[panelK*nr-1].Float32()
	p := 0
	for ; p+3 < panelK; p += 4 {
		bVec0_0 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx:][0]))
		bVec1_0 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+lanes:][0]))
		a0_0 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx]))
		a1_0 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+1]))
		a2_0 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+2]))
		a3_0 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+3]))
		acc00 = a0_0.MulAdd(bVec0_0, acc00)
		acc01 = a0_0.MulAdd(bVec1_0, acc01)
		acc10 = a1_0.MulAdd(bVec0_0, acc10)
		acc11 = a1_0.MulAdd(bVec1_0, acc11)
		acc20 = a2_0.MulAdd(bVec0_0, acc20)
		acc21 = a2_0.MulAdd(bVec1_0, acc21)
		acc30 = a3_0.MulAdd(bVec0_0, acc30)
		acc31 = a3_0.MulAdd(bVec1_0, acc31)
		bVec0_1 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+nr:][0]))
		bVec1_1 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+nr+lanes:][0]))
		a0_1 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+mr]))
		a1_1 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+mr+1]))
		a2_1 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+mr+2]))
		a3_1 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+mr+3]))
		acc00 = a0_1.MulAdd(bVec0_1, acc00)
		acc01 = a0_1.MulAdd(bVec1_1, acc01)
		acc10 = a1_1.MulAdd(bVec0_1, acc10)
		acc11 = a1_1.MulAdd(bVec1_1, acc11)
		acc20 = a2_1.MulAdd(bVec0_1, acc20)
		acc21 = a2_1.MulAdd(bVec1_1, acc21)
		acc30 = a3_1.MulAdd(bVec0_1, acc30)
		acc31 = a3_1.MulAdd(bVec1_1, acc31)
		bVec0_2 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+2*nr:][0]))
		bVec1_2 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+2*nr+lanes:][0]))
		a0_2 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+2*mr]))
		a1_2 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+2*mr+1]))
		a2_2 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+2*mr+2]))
		a3_2 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+2*mr+3]))
		acc00 = a0_2.MulAdd(bVec0_2, acc00)
		acc01 = a0_2.MulAdd(bVec1_2, acc01)
		acc10 = a1_2.MulAdd(bVec0_2, acc10)
		acc11 = a1_2.MulAdd(bVec1_2, acc11)
		acc20 = a2_2.MulAdd(bVec0_2, acc20)
		acc21 = a2_2.MulAdd(bVec1_2, acc21)
		acc30 = a3_2.MulAdd(bVec0_2, acc30)
		acc31 = a3_2.MulAdd(bVec1_2, acc31)
		bVec0_3 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+3*nr:][0]))
		bVec1_3 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+3*nr+lanes:][0]))
		a0_3 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+3*mr]))
		a1_3 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+3*mr+1]))
		a2_3 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+3*mr+2]))
		a3_3 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+3*mr+3]))
		acc00 = a0_3.MulAdd(bVec0_3, acc00)
		acc01 = a0_3.MulAdd(bVec1_3, acc01)
		acc10 = a1_3.MulAdd(bVec0_3, acc10)
		acc11 = a1_3.MulAdd(bVec1_3, acc11)
		acc20 = a2_3.MulAdd(bVec0_3, acc20)
		acc21 = a2_3.MulAdd(bVec1_3, acc21)
		acc30 = a3_3.MulAdd(bVec0_3, acc30)
		acc31 = a3_3.MulAdd(bVec1_3, acc31)
		aIdx += 4 * mr
		bIdx += 4 * nr
	}
	for ; p < panelK; p++ {
		bVec0 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx:][0]))
		bVec1 := asm.LoadFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+lanes:][0]))
		bIdx += nr
		a0 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx]))
		a1 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+1]))
		a2 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+2]))
		a3 := asm.BroadcastFloat16x16AVX512(uint16(packedA[aIdx+3]))
		aIdx += mr
		acc00 = a0.MulAdd(bVec0, acc00)
		acc01 = a0.MulAdd(bVec1, acc01)
		acc10 = a1.MulAdd(bVec0, acc10)
		acc11 = a1.MulAdd(bVec1, acc11)
		acc20 = a2.MulAdd(bVec0, acc20)
		acc21 = a2.MulAdd(bVec1, acc21)
		acc30 = a3.MulAdd(bVec0, acc30)
		acc31 = a3.MulAdd(bVec1, acc31)
	}
	outIdx0 := outRowStart*outputStride + outColStart
	outIdx1 := outIdx0 + outputStride
	outIdx2 := outIdx1 + outputStride
	outIdx3 := outIdx2 + outputStride
	acc00.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx0:]))), len(output[outIdx0:])))
	acc01.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx0+lanes:]))), len(output[outIdx0+lanes:])))
	acc10.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx1:]))), len(output[outIdx1:])))
	acc11.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx1+lanes:]))), len(output[outIdx1+lanes:])))
	acc20.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx2:]))), len(output[outIdx2:])))
	acc21.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx2+lanes:]))), len(output[outIdx2+lanes:])))
	acc30.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx3:]))), len(output[outIdx3:])))
	acc31.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx3+lanes:]))), len(output[outIdx3+lanes:])))
}

func BasePackedMicroKernel4x2_avx512_BFloat16(packedA []hwy.BFloat16, packedB []hwy.BFloat16, output []hwy.BFloat16, outputStride int, outRowStart int, outColStart int, panelK int, lanes int) {
	acc00 := asm.ZeroBFloat16x16AVX512()
	acc01 := asm.ZeroBFloat16x16AVX512()
	acc10 := asm.ZeroBFloat16x16AVX512()
	acc11 := asm.ZeroBFloat16x16AVX512()
	acc20 := asm.ZeroBFloat16x16AVX512()
	acc21 := asm.ZeroBFloat16x16AVX512()
	acc30 := asm.ZeroBFloat16x16AVX512()
	acc31 := asm.ZeroBFloat16x16AVX512()
	nr := 2 * lanes
	mr := 4
	aIdx := 0
	bIdx := 0
	_ = packedA[panelK*mr-1].Float32()
	_ = packedB[panelK*nr-1].Float32()
	p := 0
	for ; p+3 < panelK; p += 4 {
		bVec0_0 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx:][0]))
		bVec1_0 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+lanes:][0]))
		a0_0 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx]))
		a1_0 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+1]))
		a2_0 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+2]))
		a3_0 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+3]))
		acc00 = a0_0.MulAdd(bVec0_0, acc00)
		acc01 = a0_0.MulAdd(bVec1_0, acc01)
		acc10 = a1_0.MulAdd(bVec0_0, acc10)
		acc11 = a1_0.MulAdd(bVec1_0, acc11)
		acc20 = a2_0.MulAdd(bVec0_0, acc20)
		acc21 = a2_0.MulAdd(bVec1_0, acc21)
		acc30 = a3_0.MulAdd(bVec0_0, acc30)
		acc31 = a3_0.MulAdd(bVec1_0, acc31)
		bVec0_1 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+nr:][0]))
		bVec1_1 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+nr+lanes:][0]))
		a0_1 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+mr]))
		a1_1 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+mr+1]))
		a2_1 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+mr+2]))
		a3_1 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+mr+3]))
		acc00 = a0_1.MulAdd(bVec0_1, acc00)
		acc01 = a0_1.MulAdd(bVec1_1, acc01)
		acc10 = a1_1.MulAdd(bVec0_1, acc10)
		acc11 = a1_1.MulAdd(bVec1_1, acc11)
		acc20 = a2_1.MulAdd(bVec0_1, acc20)
		acc21 = a2_1.MulAdd(bVec1_1, acc21)
		acc30 = a3_1.MulAdd(bVec0_1, acc30)
		acc31 = a3_1.MulAdd(bVec1_1, acc31)
		bVec0_2 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+2*nr:][0]))
		bVec1_2 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+2*nr+lanes:][0]))
		a0_2 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+2*mr]))
		a1_2 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+2*mr+1]))
		a2_2 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+2*mr+2]))
		a3_2 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+2*mr+3]))
		acc00 = a0_2.MulAdd(bVec0_2, acc00)
		acc01 = a0_2.MulAdd(bVec1_2, acc01)
		acc10 = a1_2.MulAdd(bVec0_2, acc10)
		acc11 = a1_2.MulAdd(bVec1_2, acc11)
		acc20 = a2_2.MulAdd(bVec0_2, acc20)
		acc21 = a2_2.MulAdd(bVec1_2, acc21)
		acc30 = a3_2.MulAdd(bVec0_2, acc30)
		acc31 = a3_2.MulAdd(bVec1_2, acc31)
		bVec0_3 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+3*nr:][0]))
		bVec1_3 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+3*nr+lanes:][0]))
		a0_3 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+3*mr]))
		a1_3 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+3*mr+1]))
		a2_3 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+3*mr+2]))
		a3_3 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+3*mr+3]))
		acc00 = a0_3.MulAdd(bVec0_3, acc00)
		acc01 = a0_3.MulAdd(bVec1_3, acc01)
		acc10 = a1_3.MulAdd(bVec0_3, acc10)
		acc11 = a1_3.MulAdd(bVec1_3, acc11)
		acc20 = a2_3.MulAdd(bVec0_3, acc20)
		acc21 = a2_3.MulAdd(bVec1_3, acc21)
		acc30 = a3_3.MulAdd(bVec0_3, acc30)
		acc31 = a3_3.MulAdd(bVec1_3, acc31)
		aIdx += 4 * mr
		bIdx += 4 * nr
	}
	for ; p < panelK; p++ {
		bVec0 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx:][0]))
		bVec1 := asm.LoadBFloat16x16AVX512Ptr(unsafe.Pointer(&packedB[bIdx+lanes:][0]))
		bIdx += nr
		a0 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx]))
		a1 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+1]))
		a2 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+2]))
		a3 := asm.BroadcastBFloat16x16AVX512(uint16(packedA[aIdx+3]))
		aIdx += mr
		acc00 = a0.MulAdd(bVec0, acc00)
		acc01 = a0.MulAdd(bVec1, acc01)
		acc10 = a1.MulAdd(bVec0, acc10)
		acc11 = a1.MulAdd(bVec1, acc11)
		acc20 = a2.MulAdd(bVec0, acc20)
		acc21 = a2.MulAdd(bVec1, acc21)
		acc30 = a3.MulAdd(bVec0, acc30)
		acc31 = a3.MulAdd(bVec1, acc31)
	}
	outIdx0 := outRowStart*outputStride + outColStart
	outIdx1 := outIdx0 + outputStride
	outIdx2 := outIdx1 + outputStride
	outIdx3 := outIdx2 + outputStride
	acc00.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx0:]))), len(output[outIdx0:])))
	acc01.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx0+lanes:]))), len(output[outIdx0+lanes:])))
	acc10.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx1:]))), len(output[outIdx1:])))
	acc11.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx1+lanes:]))), len(output[outIdx1+lanes:])))
	acc20.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx2:]))), len(output[outIdx2:])))
	acc21.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx2+lanes:]))), len(output[outIdx2+lanes:])))
	acc30.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx3:]))), len(output[outIdx3:])))
	acc31.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(output[outIdx3+lanes:]))), len(output[outIdx3+lanes:])))
}

func BasePackedMicroKernel4x2_avx512(packedA []float32, packedB []float32, output []float32, outputStride int, outRowStart int, outColStart int, panelK int, lanes int) {
	acc00 := archsimd.BroadcastFloat32x16(0)
	acc01 := archsimd.BroadcastFloat32x16(0)
	acc10 := archsimd.BroadcastFloat32x16(0)
	acc11 := archsimd.BroadcastFloat32x16(0)
	acc20 := archsimd.BroadcastFloat32x16(0)
	acc21 := archsimd.BroadcastFloat32x16(0)
	acc30 := archsimd.BroadcastFloat32x16(0)
	acc31 := archsimd.BroadcastFloat32x16(0)
	nr := 2 * lanes
	mr := 4
	aIdx := 0
	bIdx := 0
	_ = packedA[panelK*mr-1]
	_ = packedB[panelK*nr-1]
	p := 0
	for ; p+3 < panelK; p += 4 {
		bVec0_0 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx])))
		bVec1_0 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+lanes])))
		a0_0 := archsimd.BroadcastFloat32x16(packedA[aIdx])
		a1_0 := archsimd.BroadcastFloat32x16(packedA[aIdx+1])
		a2_0 := archsimd.BroadcastFloat32x16(packedA[aIdx+2])
		a3_0 := archsimd.BroadcastFloat32x16(packedA[aIdx+3])
		acc00 = a0_0.MulAdd(bVec0_0, acc00)
		acc01 = a0_0.MulAdd(bVec1_0, acc01)
		acc10 = a1_0.MulAdd(bVec0_0, acc10)
		acc11 = a1_0.MulAdd(bVec1_0, acc11)
		acc20 = a2_0.MulAdd(bVec0_0, acc20)
		acc21 = a2_0.MulAdd(bVec1_0, acc21)
		acc30 = a3_0.MulAdd(bVec0_0, acc30)
		acc31 = a3_0.MulAdd(bVec1_0, acc31)
		bVec0_1 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+nr])))
		bVec1_1 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+nr+lanes])))
		a0_1 := archsimd.BroadcastFloat32x16(packedA[aIdx+mr])
		a1_1 := archsimd.BroadcastFloat32x16(packedA[aIdx+mr+1])
		a2_1 := archsimd.BroadcastFloat32x16(packedA[aIdx+mr+2])
		a3_1 := archsimd.BroadcastFloat32x16(packedA[aIdx+mr+3])
		acc00 = a0_1.MulAdd(bVec0_1, acc00)
		acc01 = a0_1.MulAdd(bVec1_1, acc01)
		acc10 = a1_1.MulAdd(bVec0_1, acc10)
		acc11 = a1_1.MulAdd(bVec1_1, acc11)
		acc20 = a2_1.MulAdd(bVec0_1, acc20)
		acc21 = a2_1.MulAdd(bVec1_1, acc21)
		acc30 = a3_1.MulAdd(bVec0_1, acc30)
		acc31 = a3_1.MulAdd(bVec1_1, acc31)
		bVec0_2 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+2*nr])))
		bVec1_2 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+2*nr+lanes])))
		a0_2 := archsimd.BroadcastFloat32x16(packedA[aIdx+2*mr])
		a1_2 := archsimd.BroadcastFloat32x16(packedA[aIdx+2*mr+1])
		a2_2 := archsimd.BroadcastFloat32x16(packedA[aIdx+2*mr+2])
		a3_2 := archsimd.BroadcastFloat32x16(packedA[aIdx+2*mr+3])
		acc00 = a0_2.MulAdd(bVec0_2, acc00)
		acc01 = a0_2.MulAdd(bVec1_2, acc01)
		acc10 = a1_2.MulAdd(bVec0_2, acc10)
		acc11 = a1_2.MulAdd(bVec1_2, acc11)
		acc20 = a2_2.MulAdd(bVec0_2, acc20)
		acc21 = a2_2.MulAdd(bVec1_2, acc21)
		acc30 = a3_2.MulAdd(bVec0_2, acc30)
		acc31 = a3_2.MulAdd(bVec1_2, acc31)
		bVec0_3 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+3*nr])))
		bVec1_3 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+3*nr+lanes])))
		a0_3 := archsimd.BroadcastFloat32x16(packedA[aIdx+3*mr])
		a1_3 := archsimd.BroadcastFloat32x16(packedA[aIdx+3*mr+1])
		a2_3 := archsimd.BroadcastFloat32x16(packedA[aIdx+3*mr+2])
		a3_3 := archsimd.BroadcastFloat32x16(packedA[aIdx+3*mr+3])
		acc00 = a0_3.MulAdd(bVec0_3, acc00)
		acc01 = a0_3.MulAdd(bVec1_3, acc01)
		acc10 = a1_3.MulAdd(bVec0_3, acc10)
		acc11 = a1_3.MulAdd(bVec1_3, acc11)
		acc20 = a2_3.MulAdd(bVec0_3, acc20)
		acc21 = a2_3.MulAdd(bVec1_3, acc21)
		acc30 = a3_3.MulAdd(bVec0_3, acc30)
		acc31 = a3_3.MulAdd(bVec1_3, acc31)
		aIdx += 4 * mr
		bIdx += 4 * nr
	}
	for ; p < panelK; p++ {
		bVec0 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx])))
		bVec1 := archsimd.LoadFloat32x16((*[16]float32)(unsafe.Pointer(&packedB[bIdx+lanes])))
		bIdx += nr
		a0 := archsimd.BroadcastFloat32x16(packedA[aIdx])
		a1 := archsimd.BroadcastFloat32x16(packedA[aIdx+1])
		a2 := archsimd.BroadcastFloat32x16(packedA[aIdx+2])
		a3 := archsimd.BroadcastFloat32x16(packedA[aIdx+3])
		aIdx += mr
		acc00 = a0.MulAdd(bVec0, acc00)
		acc01 = a0.MulAdd(bVec1, acc01)
		acc10 = a1.MulAdd(bVec0, acc10)
		acc11 = a1.MulAdd(bVec1, acc11)
		acc20 = a2.MulAdd(bVec0, acc20)
		acc21 = a2.MulAdd(bVec1, acc21)
		acc30 = a3.MulAdd(bVec0, acc30)
		acc31 = a3.MulAdd(bVec1, acc31)
	}
	outIdx0 := outRowStart*outputStride + outColStart
	outIdx1 := outIdx0 + outputStride
	outIdx2 := outIdx1 + outputStride
	outIdx3 := outIdx2 + outputStride
	acc00.Store((*[16]float32)(unsafe.Pointer(&output[outIdx0])))
	acc01.Store((*[16]float32)(unsafe.Pointer(&output[outIdx0+lanes])))
	acc10.Store((*[16]float32)(unsafe.Pointer(&output[outIdx1])))
	acc11.Store((*[16]float32)(unsafe.Pointer(&output[outIdx1+lanes])))
	acc20.Store((*[16]float32)(unsafe.Pointer(&output[outIdx2])))
	acc21.Store((*[16]float32)(unsafe.Pointer(&output[outIdx2+lanes])))
	acc30.Store((*[16]float32)(unsafe.Pointer(&output[outIdx3])))
	acc31.Store((*[16]float32)(unsafe.Pointer(&output[outIdx3+lanes])))
}

func BasePackedMicroKernel4x2_avx512_Float64(packedA []float64, packedB []float64, output []float64, outputStride int, outRowStart int, outColStart int, panelK int, lanes int) {
	acc00 := archsimd.BroadcastFloat64x8(0)
	acc01 := archsimd.BroadcastFloat64x8(0)
	acc10 := archsimd.BroadcastFloat64x8(0)
	acc11 := archsimd.BroadcastFloat64x8(0)
	acc20 := archsimd.BroadcastFloat64x8(0)
	acc21 := archsimd.BroadcastFloat64x8(0)
	acc30 := archsimd.BroadcastFloat64x8(0)
	acc31 := archsimd.BroadcastFloat64x8(0)
	nr := 2 * lanes
	mr := 4
	aIdx := 0
	bIdx := 0
	_ = packedA[panelK*mr-1]
	_ = packedB[panelK*nr-1]
	p := 0
	for ; p+3 < panelK; p += 4 {
		bVec0_0 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx])))
		bVec1_0 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+lanes])))
		a0_0 := archsimd.BroadcastFloat64x8(packedA[aIdx])
		a1_0 := archsimd.BroadcastFloat64x8(packedA[aIdx+1])
		a2_0 := archsimd.BroadcastFloat64x8(packedA[aIdx+2])
		a3_0 := archsimd.BroadcastFloat64x8(packedA[aIdx+3])
		acc00 = a0_0.MulAdd(bVec0_0, acc00)
		acc01 = a0_0.MulAdd(bVec1_0, acc01)
		acc10 = a1_0.MulAdd(bVec0_0, acc10)
		acc11 = a1_0.MulAdd(bVec1_0, acc11)
		acc20 = a2_0.MulAdd(bVec0_0, acc20)
		acc21 = a2_0.MulAdd(bVec1_0, acc21)
		acc30 = a3_0.MulAdd(bVec0_0, acc30)
		acc31 = a3_0.MulAdd(bVec1_0, acc31)
		bVec0_1 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+nr])))
		bVec1_1 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+nr+lanes])))
		a0_1 := archsimd.BroadcastFloat64x8(packedA[aIdx+mr])
		a1_1 := archsimd.BroadcastFloat64x8(packedA[aIdx+mr+1])
		a2_1 := archsimd.BroadcastFloat64x8(packedA[aIdx+mr+2])
		a3_1 := archsimd.BroadcastFloat64x8(packedA[aIdx+mr+3])
		acc00 = a0_1.MulAdd(bVec0_1, acc00)
		acc01 = a0_1.MulAdd(bVec1_1, acc01)
		acc10 = a1_1.MulAdd(bVec0_1, acc10)
		acc11 = a1_1.MulAdd(bVec1_1, acc11)
		acc20 = a2_1.MulAdd(bVec0_1, acc20)
		acc21 = a2_1.MulAdd(bVec1_1, acc21)
		acc30 = a3_1.MulAdd(bVec0_1, acc30)
		acc31 = a3_1.MulAdd(bVec1_1, acc31)
		bVec0_2 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+2*nr])))
		bVec1_2 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+2*nr+lanes])))
		a0_2 := archsimd.BroadcastFloat64x8(packedA[aIdx+2*mr])
		a1_2 := archsimd.BroadcastFloat64x8(packedA[aIdx+2*mr+1])
		a2_2 := archsimd.BroadcastFloat64x8(packedA[aIdx+2*mr+2])
		a3_2 := archsimd.BroadcastFloat64x8(packedA[aIdx+2*mr+3])
		acc00 = a0_2.MulAdd(bVec0_2, acc00)
		acc01 = a0_2.MulAdd(bVec1_2, acc01)
		acc10 = a1_2.MulAdd(bVec0_2, acc10)
		acc11 = a1_2.MulAdd(bVec1_2, acc11)
		acc20 = a2_2.MulAdd(bVec0_2, acc20)
		acc21 = a2_2.MulAdd(bVec1_2, acc21)
		acc30 = a3_2.MulAdd(bVec0_2, acc30)
		acc31 = a3_2.MulAdd(bVec1_2, acc31)
		bVec0_3 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+3*nr])))
		bVec1_3 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+3*nr+lanes])))
		a0_3 := archsimd.BroadcastFloat64x8(packedA[aIdx+3*mr])
		a1_3 := archsimd.BroadcastFloat64x8(packedA[aIdx+3*mr+1])
		a2_3 := archsimd.BroadcastFloat64x8(packedA[aIdx+3*mr+2])
		a3_3 := archsimd.BroadcastFloat64x8(packedA[aIdx+3*mr+3])
		acc00 = a0_3.MulAdd(bVec0_3, acc00)
		acc01 = a0_3.MulAdd(bVec1_3, acc01)
		acc10 = a1_3.MulAdd(bVec0_3, acc10)
		acc11 = a1_3.MulAdd(bVec1_3, acc11)
		acc20 = a2_3.MulAdd(bVec0_3, acc20)
		acc21 = a2_3.MulAdd(bVec1_3, acc21)
		acc30 = a3_3.MulAdd(bVec0_3, acc30)
		acc31 = a3_3.MulAdd(bVec1_3, acc31)
		aIdx += 4 * mr
		bIdx += 4 * nr
	}
	for ; p < panelK; p++ {
		bVec0 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx])))
		bVec1 := archsimd.LoadFloat64x8((*[8]float64)(unsafe.Pointer(&packedB[bIdx+lanes])))
		bIdx += nr
		a0 := archsimd.BroadcastFloat64x8(packedA[aIdx])
		a1 := archsimd.BroadcastFloat64x8(packedA[aIdx+1])
		a2 := archsimd.BroadcastFloat64x8(packedA[aIdx+2])
		a3 := archsimd.BroadcastFloat64x8(packedA[aIdx+3])
		aIdx += mr
		acc00 = a0.MulAdd(bVec0, acc00)
		acc01 = a0.MulAdd(bVec1, acc01)
		acc10 = a1.MulAdd(bVec0, acc10)
		acc11 = a1.MulAdd(bVec1, acc11)
		acc20 = a2.MulAdd(bVec0, acc20)
		acc21 = a2.MulAdd(bVec1, acc21)
		acc30 = a3.MulAdd(bVec0, acc30)
		acc31 = a3.MulAdd(bVec1, acc31)
	}
	outIdx0 := outRowStart*outputStride + outColStart
	outIdx1 := outIdx0 + outputStride
	outIdx2 := outIdx1 + outputStride
	outIdx3 := outIdx2 + outputStride
	acc00.Store((*[8]float64)(unsafe.Pointer(&output[outIdx0])))
	acc01.Store((*[8]float64)(unsafe.Pointer(&output[outIdx0+lanes])))
	acc10.Store((*[8]float64)(unsafe.Pointer(&output[outIdx1])))
	acc11.Store((*[8]float64)(unsafe.Pointer(&output[outIdx1+lanes])))
	acc20.Store((*[8]float64)(unsafe.Pointer(&output[outIdx2])))
	acc21.Store((*[8]float64)(unsafe.Pointer(&output[outIdx2+lanes])))
	acc30.Store((*[8]float64)(unsafe.Pointer(&output[outIdx3])))
	acc31.Store((*[8]float64)(unsafe.Pointer(&output[outIdx3+lanes])))
}

func BaseZeroSlice_avx512_Float16(s []hwy.Float16, n int) {
	vZero := asm.ZeroFloat16x16AVX512()
	lanes := 16
	var idx int
	for idx = 0; idx+lanes <= n; idx += lanes {
		vZero.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(s[idx:]))), len(s[idx:])))
	}
	for ; idx < n; idx++ {
		s[idx] = hwy.Float32ToFloat16(0)
	}
}

func BaseZeroSlice_avx512_BFloat16(s []hwy.BFloat16, n int) {
	vZero := asm.ZeroBFloat16x16AVX512()
	lanes := 16
	var idx int
	for idx = 0; idx+lanes <= n; idx += lanes {
		vZero.StoreSlice(unsafe.Slice((*uint16)(unsafe.Pointer(unsafe.SliceData(s[idx:]))), len(s[idx:])))
	}
	for ; idx < n; idx++ {
		s[idx] = hwy.Float32ToBFloat16(0)
	}
}

func BaseZeroSlice_avx512(s []float32, n int) {
	vZero := archsimd.BroadcastFloat32x16(0)
	lanes := 16
	var idx int
	for idx = 0; idx+lanes <= n; idx += lanes {
		vZero.Store((*[16]float32)(unsafe.Pointer(&s[idx])))
	}
	for ; idx < n; idx++ {
		s[idx] = 0
	}
}

func BaseZeroSlice_avx512_Float64(s []float64, n int) {
	vZero := archsimd.BroadcastFloat64x8(0)
	lanes := 8
	var idx int
	for idx = 0; idx+lanes <= n; idx += lanes {
		vZero.Store((*[8]float64)(unsafe.Pointer(&s[idx])))
	}
	for ; idx < n; idx++ {
		s[idx] = 0
	}
}
